#!/bin/sh

pngcrush -text a "profile" "$1" k8s.png
curl localhost:3000/upload-image -F 'image=@pngout.png' --compressed
sleep 3
IMG_NBR=$(curl -s localhost:3000/ | grep resized | sed "s/.*resized-image-\([0-9]*\)\.png.*/\1/")
curl -s localhost:3000/uploads/resized-image-$IMG_NBR.png -o result.png
DATA=$(docker run --rm -it -v $(pwd)/result.png:/result.png node identify -verbose /result.png | grep -A 7 "Raw profile type" | tail -5 | tr -d '\r\n')
echo ""
echo ""
echo "Content of '$1' on remote host:"
python3 -c 'print(bytes.fromhex("'${DATA}'").decode("utf-8"))'
echo ""
